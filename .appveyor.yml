version: "{build}"
clone_depth: 1
clone_folder: c:\gopath\src\github.com\rhysd\vim-startuptime
environment:
    GOPATH: c:\gopath
install:
    - echo %PATH%
    - echo %GOPATH%
    - go version
    - go env
    - go get -v -t -d ./...
    - ps: |
        $zip = $Env:APPVEYOR_BUILD_FOLDER + '\vim.zip'
        $vim = $Env:APPVEYOR_BUILD_FOLDER + '\vim\'
        $redirect = Invoke-WebRequest -URI 'http://vim-jp.org/redirects/koron/vim-kaoriya/latest/win64/'
        (New-Object Net.WebClient).DownloadFile($redirect.Links[0].href, $zip)
        [Reflection.Assembly]::LoadWithPartialName('System.IO.Compression.FileSystem') > $null
        [System.IO.Compression.ZipFile]::ExtractToDirectory($zip, $vim)
        $Env:Path = $vim + (Get-ChildItem $vim).Name + ';' + $Env:Path
    - echo %Path%
    - vim --version
build: off
test_script:
    - go build
    - go test -v -race -coverprofile=coverage.txt
after_test:
    - "SET PATH=C:\\Python34;C:\\Python34\\Scripts;%PATH%"
    - pip install codecov
    - codecov -f "coverage.txt"
deploy: off
